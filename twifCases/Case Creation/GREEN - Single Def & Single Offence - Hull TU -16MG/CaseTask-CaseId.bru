meta {
  name: CaseTask-CaseId
  type: http
  seq: 8
}

get {
  url: {{StagingUrl}}/api/cases/{{TwifCaseId}}/tasks
  body: formUrlEncoded
  auth: inherit
}

headers {
  Cms-Auth-Values: {{CIN3-Staging-Cookie-Auth}}
  x-functions-key: {{StagingKey}}
  User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; InfoPath.3)
}

script:post-response {
  // Parse the JSON response
  let response = res.getBody();
   
  // Find the item with the desired type
  let targetItem = response.find(item => item.type === "Check New PCD Case");
   
  if (targetItem) {
      // Log the ID to the console
      console.log("ID for 'Check New PCD Case':", targetItem.id);
   
      // Optionally store it in an environment variable
      bru.setEnvVar("pcd_task_id", targetItem.id);
  } else {
      console.log("Type 'Check New PCD Case' not found.");
  }
}

settings {
  encodeUrl: true
}
