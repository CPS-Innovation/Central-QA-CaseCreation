meta {
  name: CIN5 - Authenticate - Staging Copy
  type: http
  seq: 4
}

post {
  url: {{StagingWmUrl}}/api/authenticate
  body: formUrlEncoded
  auth: inherit
}

headers {
  accept: application/json
  x-functions-key: {{StagingWmKey}}
}

body:form-urlencoded {
  username: {{CIN5_Username}}
  password: {{CIN5_Password}}
}

script:post-response {
  const response = res.getBody();
   
  bru.setEnvVar("StagingWmCMSAuthValue", JSON.stringify(response));
   
  console.log('StagingWmCMSAuthValue:', response);
  
  if (response.Token) {
      bru.setGlobalEnvVar("StagingWmCMSAuth-Token", response.Token);
      console.log("StagingWmCMSAuth:", response.Token);
  } else {
      console.log("No Token");
  }
  
  
}

settings {
  encodeUrl: true
}
